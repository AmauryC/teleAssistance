START [patientId]
	
	//Constants for the button-pressed event
	stop = -1
	analyze = 0
	alert = 1
	drug = 2
	
	//Constants to process medical analysis
	changeDrug=0
	changeDoses=1
	sendAlarm=2
	analysis=-1
	task=-2
	
	//Selector for strategies
	strategy=0
	
	
	WHILE (task != stop){
		task = this.pickTask()
		
		IF (task == analyze ) {
			strategy = this.getStrategy(0)
			
			data = this.getVitalParameters()
			analysisResult = MedicalAnalysisService.analyzeData(data, strategy)
			analysis = this.getDecision(analysisResult)
			
			IF (analysis == changeDrug) {
				DrugService.changeDrug(analysisResult, patientId)
			}
			
			IF (analysis == changeDoses) {
				DrugService.changeDoses(analysisResult, patientId)
			}
			
			IF (analysis == sendAlarm) {
				AlarmService.triggerAlarm(0)
			}
		}
		
		IF (task == alert) {
			strategy = this.getStrategy(-1)
			AlarmService.triggerAlarm(strategy)
		}
		
		IF (task == drug) {
			analysisResult = this.getAnalysisResult();
			analysis = this.getDecision(analysisResult)
			
			IF(analysis == changeDrug){
				DrugService.changeDrug(analysisResult, patientId)
			}
			ELSE{
				DrugService.changeDoses(analysisResult, patientId)		
			}
		
		}
		
		this.resetNormalState()
	}
	
RETURN true