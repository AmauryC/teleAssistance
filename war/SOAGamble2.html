<!doctype html>
<!-- The DOCTYPE declaration above will set the     -->
<!-- browser's rendering engine into                -->
<!-- "Standards Mode". Replacing this declaration   -->
<!-- with a "Quirks Mode" doctype is not supported. -->

<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

<!--                                                               -->
<!-- Consider inlining CSS to reduce the number of requested files -->
<!--                                                               -->
<link type="text/css" rel="stylesheet" href="SOAGamble2.css">

<!--                                           -->
<!-- Any title is fine                         -->
<!--                                           -->
<title>Web Application Starter Project</title>

<!--                                           -->
<!-- This script loads your compiled module.   -->
<!-- If you add any GWT meta tags, they must   -->
<!-- be added before this line.                -->
<!--                                           -->
<script type="text/javascript" src="soagamble2/soagamble2.nocache.js"></script>

<script>
	var assets = 1000.0;
	var winnings = 0;
	
	function printSportEventTable(events) {
		var eventTable = document.getElementById("eventTable");
		events.forEach(function(entry) {
	    	var tr = document.createElement("tr");
	    	var td = document.createElement("td");
	    	tr.appendChild(td);
	    	var text = document.createTextNode(entry);
	    	
	    	var start = entry.indexOf("(") + 1;
	    	var end = entry.indexOf(")") - 1;
	    	var matchId = entry.substr(start, end);
	    	
	    	tr.id = "match_" + matchId;
	    	
			td.appendChild(text);
			eventTable.appendChild(tr);
		});
	}
	
	function printOdds(odds){
		var row = document.getElementById("match_" + odds[0]);
	
		for(var j=1; j<odds.length;j++){
			var td = document.createElement("td");
			td.style.paddingRight = "5px";
			td.style.textAlign = "right";
			td.style.width = "40px";
			var txt = document.createTextNode(odds[j]);
			td.appendChild(txt);
			row.appendChild(td);
		}
	}
	
	function printBet(bet){
		if (bet != undefined){			
			var row = document.getElementById("match_" + bet[0]);
		
			// amount			
			var td = document.createElement("td");
			td.style.paddingRight = "5px";
			td.style.textAlign = "right";
			td.style.width = "60px";
			var txt = document.createTextNode(bet[1]);
			td.appendChild(txt);
			row.appendChild(td);
			
			// choice			
			var td = document.createElement("td");
			td.style.paddingLeft = "5px";
			td.style.paddingRight = "5px";
			var txt = document.createTextNode(bet[2]);
			td.appendChild(txt);
			row.appendChild(td);	
		}
		
	}
	
	function printProfit(profit){
		if (profit != undefined){			
			var row = document.getElementById("match_" + profit[0]);
			
			// choice			
			var td = document.createElement("td");
			td.style.paddingLeft = "5px";
			td.style.paddingRight = "5px";
			td.style.textAlign = "center";
			var txt = document.createTextNode(profit[1]);
			td.appendChild(txt);
			row.appendChild(td);	
			
			// amount			
			var td = document.createElement("td");
			td.style.paddingRight = "5px";
			td.style.textAlign = "right";
			td.style.width = "60px";
			var txt = document.createTextNode(profit[2]);
			td.appendChild(txt);
			row.appendChild(td);
		}
	}
	
	function displayProfit(profit){
		var div = document.getElementById("profits");
		div.innerText = "Your profits : "+profit.toFixed(2)+" €";
		
		assets = assets + profit;
		winnings = profit - winnings;
		
		var div = document.getElementById("winnings");
		div.innerText = "Winnings : "+winnings.toFixed(2)+" €";
		
		computeAssets(0);
		
	}
	
	function initiateSequence(){
		document.getElementById("profits").innerHTML="";
		var table = document.getElementById("eventTable");
		for(var i = table.rows.length - 1; i > 0; i--)
		{
    		table.deleteRow(i);
		}
		
		document.getElementById("winnings").innerText = "";
		document.getElementById("paid_money").innerText = "";
		document.getElementById("profits").innerText = "";
		
		launchWorkflow();
		
	}
	
	function computeAssets(paid){
		assets = assets-paid;
		console.log(assets, paid);
		var span = document.getElementById("assets");
		span.innerHTML="";
		var txt = document.createTextNode("Available : "+assets.toFixed(2)+" €");
		span.appendChild(txt);
		
		if (paid > 0) {
			winnings = paid;
			var div = document.getElementById("paid_money");
			div.innerText = "You paid: " + paid.toFixed(2) + " €";
		}
	}
</script>
</head>

<!--                                           -->
<!-- The body can have arbitrary html, or      -->
<!-- you can leave the body empty if you want  -->
<!-- to create a completely dynamic UI.        -->
<!--                                           -->
<body>

	<!-- OPTIONAL: include this if you want history support -->
	<iframe src="javascript:''" id="__gwt_historyFrame" tabIndex='-1'
		style="position: absolute; width: 0; height: 0; border: 0"></iframe>

	<!-- RECOMMENDED if your web app will not function without JavaScript enabled -->
	<noscript>
		<div
			style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
			Your web browser must have JavaScript enabled in order for this
			application to display correctly.</div>
	</noscript>
	<h1>Gambling SOA system</h1>
	<p>
		<span id="assets">Available : 1000.00 €</span><br/>
		Click here to <a href="javascript:initiateSequence()">launch the automatic bet sequence</a>
	</p>

	<table id="eventTable">
		<tr>
			<th style="width:300px">
				Event
			</th>
			<th colspan="3" style="width:200px">
				Odds
			</th>
			<th colspan="2" style="width:100px">
				Bet
			</th>
			<th colspan="2" style="width:100px">
				Result
			</th>
		</tr>
	</table>
	<br/>
	<div id="paid_money"></div>
	<div id="profits"></div>
	<div id="winnings"></div>
</body>
</html>
